<!DOCTYPE html>
<html lang="en" x-data="app()">

<head>
    <meta charset="UTF-8">

    <title>Lanuit Admin</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://unpkg.com/alpinejs" defer></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="styles.css">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Favicons -->
    <link rel="icon" type="image/png" sizes="16x16" href="icons/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/favicon-32x32.png">

    <!-- iOS/Android home screen icon -->
    <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-icon-180x180.png">
</head>

<body>
    <img id="animatedImage" src="icons/logo1x.png" alt="Logo">
    <div class="new-screen">


        <div x-show="page === 'login'" class="login-container">
            <div class="login-form">
                <img src="icons/logo1x.png" alt="Login" class="login-image">
                <input type="text" placeholder="Login" x-model="loginUsername">
                <div class="password-wrapper">
                    <input :type="showLoginPassword ? 'text' : 'password'" placeholder="Password"
                        x-model="loginPassword">
                    <span class="toggle-password" @click="showLoginPassword = !showLoginPassword">
                        <img x-show="showLoginPassword" src="icons/eye.fill.png" alt="Show Password" class="eye-icon">
                        <img x-show="!showLoginPassword" src="icons/eye.slash.fill.png" alt="Hide Password"
                            class="eye-icon">
                    </span>
                </div>
                <button @click="login()">Log in</button>
            </div>
            <p class="register-link">
                Donâ€™t have an account? <a @click="page = 'register'">Sign Up</a>
            </p>
        </div>


        <div x-show="page === 'register'" class="login-container">
            <div class="login-form">
                <img src="icons/logo1x.png" alt="Register" class="login-image">
                <input type="text" placeholder="Login" x-model="registerUsername">
                <div class="password-wrapper">
                    <input :type="showRegisterPassword ? 'text' : 'password'" placeholder="Password"
                        x-model="registerPassword">
                    <span class="toggle-password" @click="showRegisterPassword = !showRegisterPassword">
                        <img x-show="showRegisterPassword" src="icons/eye.fill.png" alt="Show Password"
                            class="eye-icon">
                        <img x-show="!showRegisterPassword" src="icons/eye.slash.fill.png" alt="Hide Password"
                            class="eye-icon">
                    </span>
                </div>
                <div class="password-wrapper confirm">
                    <input :type="showConfirmPassword ? 'text' : 'password'" placeholder="Confirm Password"
                        x-model="confirmPassword">
                    <span class="toggle-password" @click="showConfirmPassword = !showConfirmPassword">
                        <img x-show="showConfirmPassword" src="icons/eye.fill.png" alt="Show Confirm Password"
                            class="eye-icon">
                        <img x-show="!showConfirmPassword" src="icons/eye.slash.fill.png" alt="Hide Confirm Password"
                            class="eye-icon">
                    </span>
                </div>
                <button @click="register()">Register</button>
            </div>
            <p class="register-link">
                Already have an account? <a @click="page = 'login'">Log in</a>
            </p>
        </div>


        <div x-show="page === 'registerResponse'" class="login-container">
            <div class="login-form">
                <img src="icons/logo1x.png" alt="Register Response" class="login-image">

                <h2 class="register-success">Registration successful!</h2>
                <p class="register-success single-line">
                    A confirmation email will be sent to your inbox shortly.
                    <span x-text="registerUsername"></span>
                </p>
            </div>
            <p class="register-link">
                Back to <a @click="page = 'login'">Log in</a>
            </p>
        </div>


        <div x-show="page === 'main'" class="split-container">
            <aside class="split-sidebar">
                <nav class="tab-nav">
                    <button @click="activeTab = 'tab1'" :class="{ 'active': activeTab === 'tab1' }">
                        <img src="icons/dashboard.png" alt="Dashboard" class="icon">
                        Dashboard
                    </button>
                    <button @click="activeTab = 'tab2'" :class="{ 'active': activeTab === 'tab2' }">
                        <img src="icons/products.png" alt="Products" class="icon">
                        Products
                    </button>
                    <button @click="activeTab = 'tab3'" :class="{ 'active': activeTab === 'tab3' }">
                        <img src="icons/orders.png" alt="Orders" class="icon">
                        Orders
                    </button>
                    <button @click="activeTab = 'tab4'" :class="{ 'active': activeTab === 'tab4' }">
                        <img src="icons/settings.png" alt="Settings" class="icon">
                        Settings
                    </button>
                    <button @click="activeTab = 'tab5'" :class="{ 'active': activeTab === 'tab5' }">
                        <img src="icons/notifications.png" alt="Notifications" class="icon">
                        Notifications
                    </button>
                </nav>
            </aside>

            <main class="split-content">
                <div x-show="activeTab === 'tab1'" x-init="saleStatisticsGraph()"
                    x-effect="if (activeTab === 'tab1') saleStatisticsGraph()" class="tab-content">
                    <h1 class="page-title">Dashboard</h1>
                    <canvas x-ref="salesChart"></canvas>
                </div>



                <div x-show="activeTab === 'tab2'" x-effect="if (activeTab === 'tab2') fetchCategories()"
                    class="tab-content">
                    <!-- class="tab-content" x-transition:enter.duration.500ms x-transition:leave.duration.300ms> -->
                    <div class="page-header">
                        <div class="page-header-spacer"></div>
                        <h1 class="page-title">Products</h1>
                        <button class="header-button" @click="showAddCategory = true">
                            <img src="icons/plus.png" alt="plus" class="icon" />
                            Add Category
                        </button>
                    </div>

                    <p x-show="products.length === 0" class="empty-message">There is no product yet</p>

                    <div x-show="products.length > 0" class="product-list" x-transition>

                        <template x-for="category in products" :key="category.id">

                            <div class="category-container">
                                <h3 class="category-name-title" x-text="category.name"></h3>

                                <div class="product-collection-view">

                                    <button class="add-product-tile" @click="showAddProductForm(category.id)">
                                        <img src="icons/plus.item.png" alt="Add Product">
                                    </button>

                                    <template x-for="product in category.products" :key="product.id">
                                        <div class="product-item">
                                            <img :src="'https://ftlcafe.pythonanywhere.com' + product.image"
                                                :alt="product.name" class="product-image">
                                            <p class="product-name" x-text="product.name"></p>
                                            <p class="product-price" x-text="'$' + product.price"></p>
                                        </div>
                                    </template>

                                </div>



                            </div>
                        </template>
                    </div>
                </div>



                <div x-show="activeTab === 'tab3'" x-init="fetchOrders()"
                    x-effect="if (activeTab === 'tab3') fetchOrders()" class="tab-content">

                    <h1 class="page-title">Orders</h1>

                    <template x-if="orders.length === 0">
                        <p class="empty-message">No orders yet</p>
                    </template>

                    <div class="order-list">
                        <template x-for="order in orders" :key="order.id">
                            <div class="order-card">

                                <h3>Order #<span x-text="order.id"></span></h3>

                                <div class="order-item-row">
                                    <p><strong>Product:</strong> <span x-text="order.product"></span></p>
                                </div>

                                <div class="order-item-row">
                                    <p><strong>Quantity:</strong> <span x-text="order.quantity"></span></p>
                                </div>

                                <div class="order-item-row">
                                    <p><strong>Status:</strong> <span x-text="order.status"></span></p>
                                </div>


                                <div class="order-item" x-data="{ open: false }">
                                    <hr>

                                    <div class="order-summary">
                                        <!-- your product info -->
                                    </div>

                                    <div class="order-extra" x-show="open" x-collapse>
                                        <p><strong>Note:</strong> <span x-text="order.note"></span></p>

                                        <p class="order-date">
                                            <strong>Created:</strong>
                                            <span x-text="new Date(order.created_at).toLocaleString()"></span>
                                        </p>
                                    </div>
                                    <div class="toggle-wrapper">


                                        <button class="toggle-combo-btn" @click="open = !open">
                                            <img :src="open ? 'icons/show-less.png' : 'icons/show-more.png'"
                                                class="toggle-icon">
                                            <span x-text="open ? 'Show less' : 'Show more'"></span>
                                        </button>



                                        <button class="delete-btn" @click="deleteOrder(order.id)">
                                            Delete
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>






                <div x-show="activeTab === 'tab4'" class="tab-content">
                    <h1 class="page-title">Settings</h1>
                    <p>Settings content goes here</p>
                </div>

                <div x-show="activeTab === 'tab5'" class="tab-content">
                    <h1 class="page-title">Notifications</h1>
                    <p>Notifications content goes here</p>
                </div>
            </main>
        </div>

        <div x-show="showAddCategory" class="alert-backdrop" x-transition>
            <div class="alert-box">
                <h2 class="alert-title">Name</h2>
                <input type="text" placeholder="Enter category name" class="alert-input" x-model="newCategory">
                <div class="alert-line"></div>
                <button class="alert-button cancel" @click="resetAddCategoryForm()">Cancel</button>
                <button class="alert-button create" @click="createCategory()">
                    Create
                </button>
            </div>
        </div>

        <script src="app.js"></script>

        <div x-show="showAddProduct" class="alert-backdrop" x-transition>
            <div class="alert-box product-form-box">
                <h2 class="alert-title">
                    New Product in Category: <span x-text="addProductCategoryId"></span>
                </h2>

                <!-- <p class="input-label">Product Name</p>
                <input type="text" placeholder="Enter product name" class="alert-input form-input"
                    x-model="addProductTempName"> -->

                <div class="form-grid">
                    <div class="left-inputs">


                        <p class="input-label">Product Name</p>
                        <input type="text" placeholder="Enter product name" class="alert-input form-input"
                            x-model="addProductTempName">

                        <p class="input-label">Price</p>
                        <input type="number" placeholder="Enter price" class="alert-input form-input"
                            x-model="addProductTempPrice">
                    </div>

                    <div class="right-image-area">
                        <p class="input-label">Product Image</p>

                        <input type="file" id="newProductImage" class="hidden-file-input"
                            @change="handleImageSelection($event.target.files[0])" accept="image/*">
                        <label for="newProductImage" class="custom-image-frame"
                            :style="newProductImagePreview ? `background-image: url(${newProductImagePreview})` : ''">
                            <template x-if="!newProductImagePreview">
                                <img src="icons/add.image.png" alt="Add Product" class="plus-icon">
                            </template>
                        </label>
                    </div>
                </div>
                <div class="alert-line"></div>

                <div class="form-buttons">
                    <button class="alert-button cancel" @click="resetAddProductForm()">Cancel</button>
                    <button class="alert-button create" @click="addNewProduct()">
                        Save Product
                    </button>
                </div>
            </div>
        </div>

        <div x-show="showToast" x-transition :class="toastType === 'success' ? 'toast-success' : 'toast-error'"
            class="toast-center"
            style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 999999999;">
            <span x-text="message"></span>
        </div>


</body>

</html>